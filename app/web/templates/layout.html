<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Creative Funnel Admin{% endblock %}</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/admin/dashboard">
                <i class="bi bi-magic me-2"></i>
                Creative Funnel Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="/admin/dashboard">
                        <i class="bi bi-speedometer2 me-1"></i>Обзор
                    </a>
                    <a class="nav-link" href="/admin/products">
                        <i class="bi bi-box-seam me-1"></i>Продукты
                    </a>
                    <a class="nav-link" href="/admin/providers">
                        <i class="bi bi-cpu me-1"></i>Конфигурация LLM
                    </a>
                    <a class="nav-link" href="/admin/orders">
                        <i class="bi bi-cart3 me-1"></i>Заказы
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="container py-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="bi bi-info-circle me-2"></i>
                <strong class="me-auto" id="toastTitle">Система</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>

    <footer class="container py-4 mt-auto border-top border-secondary-subtle">
        <div class="text-center text-secondary small">
            &copy; 2025 Creative Funnel Bot Admin. Built with <i class="bi bi-heart-fill text-danger mx-1"></i>.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

        // Toast helper
        function showToast(message, title = 'Система', type = 'info') {
            const toastEl = document.getElementById('liveToast');
            const toast = bootstrap.Toast.getOrCreateInstance(toastEl, { delay: 2500, autohide: true });
            
            // Add listener once
            if (!toastEl.dataset.smokeListenerSet) {
                toastEl.addEventListener('hide.bs.toast', (e) => {
                    if (toastEl.dataset.smokeHiding === "1") {
                        toastEl.dataset.smokeHiding = "0"; // reset for next time
                        return;
                    }

                    e.preventDefault();
                    toastEl.classList.add('toast-smoke-out');

                    setTimeout(() => {
                        toastEl.classList.remove('toast-smoke-out');
                        toastEl.dataset.smokeHiding = "1";
                        toast.hide();
                    }, 650);
                });
                toastEl.dataset.smokeListenerSet = "1";
            }

            document.getElementById('toastTitle').innerText = title;
            document.getElementById('toastMessage').innerText = message;
            toastEl.className = `toast bg-${type === 'error' ? 'danger' : (type === 'success' ? 'success' : 'info')} text-white`;
            toast.show();
        }

        // Active link highlighting
        document.querySelectorAll('.nav-link').forEach(link => {
            if (link.getAttribute('href') === window.location.pathname) {
                link.classList.add('active');
            }
        });

        // Handle saved notification
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('saved') === '1') {
                showToast('Изменения успешно сохранены', 'Успех', 'success');
                
                // Remove 'saved' parameter from URL without reloading
                const newUrl = new URL(window.location.href);
                newUrl.searchParams.delete('saved');
                window.history.replaceState({}, document.title, newUrl.pathname + newUrl.search);
            }
        });
    </script>
</body>
</html>