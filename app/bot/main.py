–ó–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç ¬´–í—ã—Ä—É—á–∫–∞¬ª –Ω–∞ /admin/dashboard –ø–æ –æ–ø–ª–∞—Ç–∞–º –ÆKassa
–ì–¥–µ –≤–∏–¥–Ω–æ –ø—Ä–æ–±–ª–µ–º—É

–ù–∞ –¥–∞—à–±–æ—Ä–¥–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è total_revenue (—Å–µ–π—á–∞—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 49 ‚ÇΩ –ø—Ä–∏ 13 –∑–∞–∫–∞–∑–∞—Ö). 

dashboard


–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω —Ä–æ—É—Ç–µ—Ä –≤–µ–±—Ö—É–∫–æ–≤ –ÆKassa, –∑–Ω–∞—á–∏—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç. 

main

–¶–µ–ª–µ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ (–∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

total_revenue = SUM(—É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ÆKassa)
–ø—Ä–∏ —ç—Ç–æ–º –≤ –≤—ã–±–æ—Ä–∫—É –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º paid.

–ö–∞–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è ‚Äú—É—Å–ø–µ—à–Ω—ã–º–∏‚Äù

–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–π —Å—Ö–µ–º—ã capture, –Ω–æ –ø–æ —Å–º—ã—Å–ª—É:

–µ—Å–ª–∏ –∞–≤—Ç–æ-capture: —É—á–∏—Ç—ã–≤–∞—Ç—å succeeded

–µ—Å–ª–∏ –¥–≤—É—Ö—Å—Ç–∞–¥–∏–π–Ω–∞—è –æ–ø–ª–∞—Ç–∞: —É—á–∏—Ç—ã–≤–∞—Ç—å ‚Äú–æ–ø–ª–∞—á–µ–Ω/–∑–∞—Ö–≤–∞—á–µ–Ω‚Äù (–æ–±—ã—á–Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö), –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ ‚Äúwaiting_for_capture‚Äù

–í –¢–ó –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥ –≤–∞—à—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (—Å–º. Acceptance Criteria –Ω–∏–∂–µ).

–ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

–ù–µ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã —Å—Ç–∞–¥–∏–π/–ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–∞–∫ –≤—ã—Ä—É—á–∫—É ‚Äî —ç—Ç–æ ‚Äú—Å—Ç–æ–∏–º–æ—Å—Ç—å‚Äù, –Ω–æ –≤—ã—Ä—É—á–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ –æ–ø–ª–∞—Ç–∞–º (–≤—ã —Ç–∞–∫ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏).

–ù–µ –≤–∫–ª—é—á–∞—Ç—å –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ/–æ—à–∏–±–æ—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏.

–ù–µ –≤–∫–ª—é—á–∞—Ç—å failed/cancelled —Å—Ç–∞–¥–∏–∏ ‚Äî –Ω–æ –ø–æ—Å–∫–æ–ª—å–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—ã—Ä—É—á–∫–∏ –ø–ª–∞—Ç–µ–∂–∏, —Å—Ç–∞–¥–∏–∏ –≤–æ–æ–±—â–µ –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º (—á—Ç–æ–±—ã –±—ã–ª–æ —á—Ç–æ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å)
–ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π (Payment/Transaction)

–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤ –ë–î —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –º–∏–Ω–∏–º—É–º:

payment_id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –∏–∑ –ÆKassa) ‚Äî UNIQUE (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

order_id

amount_value (Decimal) –∏ currency (–æ–∂–∏–¥–∞–µ–º RUB)

status (–∫–∞–∫ –º–∏–Ω–∏–º—É–º succeeded/captured/failed/canceled/refunded‚Ä¶)

created_at

(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) refunded_amount / —Å–æ–±—ã—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ—Ç

–°–¥–µ–ª–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ:

–¥–æ–±–∞–≤–∏—Ç—å –≤ orders –ø–æ–ª—è:

paid_amount (Decimal)

paid_currency (RUB)

paid_at

yookassa_payment_id (UNIQUE)

–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ö –ø–æ –≤–µ–±—Ö—É–∫—É ‚Äú—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞‚Äù.

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (—á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞—Ç—å)
1) –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –≤–µ–±—Ö—É–∫–æ–≤ –ÆKassa

–ù–∞ —Å–æ–±—ã—Ç–∏–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:

–Ω–∞–π—Ç–∏ order_id (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ metadata –ø–ª–∞—Ç–µ–∂–∞)

–ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ paid

—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂ –≤ –ë–î (–∏–ª–∏ –≤ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ—Ç)

–æ–±–µ—Å–ø–µ—á–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–µ–±—Ö—É–∫ —Å —Ç–µ–º –∂–µ payment_id –Ω–µ –¥–æ–ª–∂–µ–Ω —É–¥–≤–∞–∏–≤–∞—Ç—å –≤—ã—Ä—É—á–∫—É

2) –í –∞–¥–º–∏–Ω—Å–∫–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ /admin/dashboard

–°—á–∏—Ç–∞—Ç—å total_revenue –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–º –∑–∞–ø—Ä–æ—Å–æ–º SUM –ø–æ –ë–î, –∞ –Ω–µ —Ü–∏–∫–ª–æ–º –≤ Python.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (—Å–º—ã—Å–ª):

–≤–∑—è—Ç—å –ø–ª–∞—Ç–µ–∂–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ‚Äú—É—Å–ø–µ—à–Ω–æ‚Äù

JOIN –Ω–∞ orders –∏ —Ñ–∏–ª—å—Ç—Ä orders.status = 'paid'

SUM –ø–æ amount_value

COALESCE –≤ 0

Acceptance Criteria (–≥–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)

–î–∞—à–±–æ—Ä–¥

total_revenue –Ω–∞ /admin/dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π. 

dashboard

–§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–∫–∞–∑–∞–º

–í —Å—É–º–º—É –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º paid (–¥–∞–∂–µ –µ—Å–ª–∏ –ø–ª–∞—Ç–µ–∂ –µ—Å—Ç—å, –Ω–æ –∑–∞–∫–∞–∑ –Ω–µ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –≤ paid ‚Äî –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å).

–§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º

–í —Å—É–º–º—É –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ —É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤ –∫–æ–¥–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä SUCCESS_STATUSES = {...}).

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ webhook –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—ã—Ä—É—á–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ (UNIQUE –ø–æ payment_id + upsert/ignore).

–í–∞–ª—é—Ç–∞ –∏ —Ç–æ—á–Ω–æ—Å—Ç—å

–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Decimal (–Ω–µ float).

–ï—Å–ª–∏ –≤–∞–ª—é—Ç–∞ –Ω–µ RUB ‚Äî –ø–ª–∞—Ç–µ–∂ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–ª–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞ (–Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ, –Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º).

–°—Ç–∞–¥–∏–∏

–°—Ç–∞—Ç—É—Å—ã —Å—Ç–∞–¥–∏–π failed/cancelled –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—ã—Ä—É—á–∫—É (–≤—ã—Ä—É—á–∫–∞ –∏–¥—ë—Ç –ø–æ –æ–ø–ª–∞—Ç–∞–º).

–¢–µ—Å—Ç—ã

1 –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ (1 –ø–ª–∞—Ç–µ–∂) ‚Üí –≤—ã—Ä—É—á–∫–∞ = —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞

2 –ø–ª–∞—Ç–µ–∂–∞ –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–∫–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–ø–ª–∞—Ç–∞) ‚Üí –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:

–ª–∏–±–æ —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω ‚Äú–∞–∫—Ç—É–∞–ª—å–Ω—ã–π‚Äù (—Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ order_id)

–ª–∏–±–æ —É—á–∏—Ç—ã–≤–∞–µ–º –æ–±–∞ (—Ä–µ–¥–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
üëâ –í –¢–ó –≤—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 –∑–∞–∫–∞–∑ = 1 —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂.